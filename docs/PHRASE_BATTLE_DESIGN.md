# フレーズバトルシステム企画書

**作成日:** 2026-01-25
**ステータス:** 設計中

---

## コンセプト

> 「集めた言葉が武器になる」

従来のRPGでは剣や魔法で戦うが、本作では**言葉（フレーズ）**で魔物と心を通わせる。
プレイヤーは世界を探索してエスペラント語のフレーズを収集し、バトルで戦略的に使用する。

---

## 世界観との統合

- エスペラント語は異種族間の共通語として作られた
- 「魔物」と呼ばれる存在も実は言葉が通じる
- 主人公はエスペラント語を知らない国から来た勇者
- 冒険を通じて言葉を学び、「敵」と対話できるようになる

**テーマ:** 言葉が通じれば、敵ではなくなる

---

## フレーズ収集システム

### 二段階の収集プロセス

フレーズの習得は「発見」と「解読」の二段階に分かれる。

```
┌─────────────────────────────────────────────────────────┐
│  段階1: 発見                                            │
│  ─────────────────────────────────────────────────────  │
│  遺跡の石碑、手記、会話などでフレーズに遭遇             │
│  → スペル（文字）だけ記録される                        │
│  → 意味は「???」のまま                                 │
│                                                         │
│  段階2: 解読                                            │
│  ─────────────────────────────────────────────────────  │
│  学者に聞く、辞書を見つける、文脈から理解する           │
│  → 日本語訳が判明する                                  │
│  → フレーズ図鑑に正式登録                              │
└─────────────────────────────────────────────────────────┘
```

### 収集源

| 収集源 | 説明 | 例 |
|--------|------|-----|
| **住民との会話** | 日常会話で使われるフレーズ | Saluton（こんにちは）、Dankon（ありがとう） |
| **手記・日記** | 個人の感情や体験が綴られた文書 | Mi bedaŭras...（後悔している） |
| **図書館の書物** | 丁寧な表現、学術用語、歴史 | 敬語表現、古い言い回し |
| **石碑・遺跡** | 古代のフレーズ、儀式的な言葉 | Mi venas pace（平和のために来た） |
| **魔物との会話** | その種族特有の言い回し | ゴブリン語風の表現など |
| **看板・掲示物** | 公共の場で使われる表現 | 警告、案内、お知らせ |

### フレーズの状態

```
┌──────────────┬────────────────────────────────────────┐
│ 状態         │ 説明                                   │
├──────────────┼────────────────────────────────────────┤
│ 未発見       │ まだ出会っていない                     │
│ 発見済み     │ スペルは知っているが意味が不明         │
│ 解読済み     │ 意味も理解している（完全習得）         │
└──────────────┴────────────────────────────────────────┘
```

---

## バトルシステム

### 基本フロー

```
エンカウント発生
    ↓
魔物が警戒状態で登場
    ↓
プレイヤーがフレーズを選択
    ↓
魔物の反応（親密度変化）
    ↓
繰り返し or 終了条件達成
    ↓
結果（友好 / 逃走 / 戦闘）
```

### フレーズ選択UI

```
┌─────────────────────────────────────┐
│ 森の番人 が道を塞いでいる           │
│ 親密度: ████░░░░░░ 40%              │
│                                     │
│ 「人間か...何の用だ」               │
│                                     │
├─────────────────────────────────────┤
│ [フレーズを選ぶ]                    │
│                                     │
│ ▶ Saluton                           │
│   (こんにちは)              [習得]  │
│                                     │
│   Mi venas pace                     │
│   (???)                    [未解読] │
│                                     │
│   Pardonu min                       │
│   (すみません)              [習得]  │
│                                     │
│ [↑↓: 選択] [Z: 決定] [X: 逃げる]   │
└─────────────────────────────────────┘
```

### キーワード解錠システム

特定のキャラクター（主にストーリーボス）は、特定のフレーズを言わないと会話が進まない。

**例: ゴブリン長老**

```
初回遭遇:
┌─────────────────────────────────────┐
│ ゴブリン長老 は警戒している...      │
│                                     │
│ 「人間の言葉など聞く耳持たん！」    │
│                                     │
│ → 何を言っても無視される            │
└─────────────────────────────────────┘

情報収集後:（村人から「長老は昔人間に裏切られた」と聞く）

┌─────────────────────────────────────┐
│ ▶ Pardonu (ごめんなさい)            │
│                                     │
│ 「...お前、謝れるのか」             │
│ 「少しだけ話を聞いてやろう」        │
│                                     │
│ → 会話が解錠される                  │
└─────────────────────────────────────┘
```

### フレーズの効果

フレーズにタイプ分類は設けない。各キャラクターが各フレーズに対して**個別のリアクション**を持つ。

```
例: 森の番人の場合

「Saluton」      → 「ふん、挨拶か」（親密度 +5）
「Mi venas pace」→ 「平和のため...？信じていいのか」（親密度 +20）
「Pardonu」      → 「謝る必要はない」（親密度 +0）
「Kiel vi fartas」→ 「俺の心配をするのか？」（親密度 +15）

例: ゴブリン長老の場合

「Saluton」      → 「...」（無視）
「Mi venas pace」→ 「そんな言葉で騙されるか」（親密度 -5）
「Pardonu」      → 「...謝れるのか、人間が」（解錠 + 親密度 +30）
```

**設計意図:**
- キャラクターごとに「響く言葉」が異なる
- NPCからのヒントや試行錯誤で発見する楽しさ
- 機械的な相性表ではなく、物語的な納得感

### 未解読フレーズの使用

意味がわからないままフレーズを使うことができる。

| 結果 | 説明 |
|------|------|
| **成功** | 「通じた！（何て言ったんだろう...）」偶然正解 |
| **失敗** | 「怒らせてしまった...何がまずかった？」 |
| **ヒント** | 相手の反応から意味を推測できる |

**学習的価値:** 文脈やスペルから意味を推測する体験

---

## データ構造（実装用）

### PhraseEntry の拡張

```cpp
struct PhraseEntry {
    std::string phraseId;       // 一意のID
    std::string esperanto;      // エスペラント文
    std::string japanese;       // 日本語訳（解読後に表示）
    int areaLevel;              // 出現エリアレベル

    // 状態
    bool discovered;            // 発見済みか
    bool understood;            // 解読済みか

    // 収集情報
    std::string sourceType;     // 収集源の種類（npc, book, monument, etc.）
    std::string sourceId;       // 収集源のID
};
```

※ フレーズのタイプ分類は設けない。効果は敵キャラクターごとの個別設定で表現する。

### EnemyConversation の設計

```cpp
struct EnemyConversation {
    std::string enemyId;

    // 解錠キーワード（必要な場合）
    std::optional<std::string> unlockPhraseId;
    std::string lockedMessage;      // 解錠前のセリフ
    std::string unlockMessage;      // 解錠時のセリフ

    // フレーズごとの反応
    struct Reaction {
        std::string phraseId;
        int affinityChange;         // 親密度変化
        std::string responseText;   // 反応セリフ
    };
    std::vector<Reaction> reactions;

    // デフォルト反応
    Reaction defaultReaction;
};
```

---

## フレーズ図鑑の更新

### 表示の変更

```
┌─────────────────────────────────────┐
│  フレーズ図鑑  [5/12 解読済み]      │
├─────────────────────────────────────┤
│ ✓ Saluton                           │
│   (こんにちは)                      │
│   村人との会話で習得                │
│                                     │
│ ? Mi venas pace                     │
│   (???)                             │
│   [未解読] 古代遺跡で発見           │
│                                     │
│ ░ ??????????                        │
│   (未発見)                          │
│                                     │
│ [↑↓: 選択] [Z: 詳細] [X: 戻る]     │
└─────────────────────────────────────┘
```

### カウント表示

- **発見数:** 見つけたフレーズの総数
- **解読数:** 意味がわかっているフレーズの数
- **収集率:** 解読数 / 全フレーズ数

---

## ゲーム進行との連携

### 序盤（チュートリアル）

1. 最初の村で基本フレーズを習得（挨拶、お礼）
2. 村の外で初めての魔物と遭遇
3. 習得したフレーズで会話成功 → システム理解

### 中盤

1. 各地で新しいフレーズを発見
2. 未解読のまま使ってみる体験
3. 図書館や学者で意味を解読
4. ストーリーボスに必要なキーワードを探す

### 終盤

1. 古代語や特殊フレーズが重要に
2. 言葉の力で大きな問題を解決
3. 全フレーズ収集（やりこみ要素）

---

## 今後の検討事項

### 優先度高

- [ ] フレーズの具体的なリスト作成（エリアごと）
- [ ] 各魔物の性格設定と有効フレーズの対応表
- [ ] 解錠が必要なストーリーボスの設計

### 優先度中

- [ ] 未解読フレーズ使用時のリスク/リワードバランス
- [ ] 各キャラクターのフレーズ反応テーブル作成
- [ ] 収集源の配置設計（マップとの連携）

### 優先度低

- [ ] レアフレーズ（隠し要素）
- [ ] フレーズコンボ（複数フレーズの組み合わせ）
- [ ] 実績システムとの連携

---

## 参考

- ポケモン: タイプ相性による戦略性
- ドラクエ: 「はなす」コマンドの活用
- アンダーテール: 敵との会話による解決

---

## 変更履歴

| 日付 | 内容 |
|------|------|
| 2026-01-25 | 初版作成 |
